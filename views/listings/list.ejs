<% layout('/layouts/boilerplate') %>
<script>
  maptoken = "<%= process.env.MAP_TOKEN %>"
  coordinates=["<%= list.geometry.coordinates.join(',') %>"]
  let title = "<%= list.title %>"; 
</script>
  <body>
    <div class="row mt-4">
      <div class="col-6 offset-2">
        <h1>
          <%= list.title %>
        </h1>
        <div class="card" style="width: 40rem;">
          <img src="<%=list.image.url%>" class="card-img-top" alt="list_image" style="height: 20rem;">
          <div class="card-body">
            <!-- <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> -->
            <p>Hosted by <b>
                <%= list.owner.username %>
              </b></p>
            <%= list.description %><br>
              &#8377; <%= list.price.toLocaleString('en-IN') %><br>
                <%= list.location %><br>
                  <%= list.country %><br>


                    <% if(currUser && list.owner._id.equals(currUser._id)) { %>
                      <div class="buttons">
                        <form action="/listings/<%=list.id%>/edit"><button class="btn edit-btn">edit</button></form>
                        <form method="post" action="/listings/<%=list.id%>?_method=DELETE"><button
                            class="btn delete-btn">delete</button></form>
                      </div>
                      <% }%>

                        <hr>

                        <div class="mt-3 row mt-4">
                          <%if(currUser){%>


                            <h4>leave a review</h4>
                            <form action="/listings/<%=list.id%>/reviews" method="POST" class=" needs-validation"
                              novalidate>
                              <div>


                                <fieldset class="starability-grow">
                                  <legend>Rating</legend>
                                  <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1"
                                    checked aria-label="No rating." />
                                  <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                                  <label for="first-rate1" title="Terrible">1 star</label>
                                  <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                                  <label for="first-rate2" title="Not good">2 stars</label>
                                  <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                                  <label for="first-rate3" title="Average">3 stars</label>
                                  <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                                  <label for="first-rate4" title="Very good">4 stars</label>
                                  <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                                  <label for="first-rate5" title="Amazing">5 stars</label>
                                </fieldset>


                              </div>

                              <div class="mb-3 mt-4">
                                <label class="form-label" for="comment">Comment</label>
                                <textarea name="review[comment]" class="form-control" id="comment" rows="5" cols="60"
                                  required></textarea>
                                <div class="invalid-feedback">
                                  Please write a comment first
                                </div>
                              </div>

                              <button class="btn btn-outline-dark">Submit</button>
                              <hr>
                            </form>
                            <% }%>
                        </div>
                       <% if(list.reviews.length){%>
                          <div class="row">
                            <h4>All Reviews</h4>
                            <%for(review of list.reviews){%>
                              <div class="card card-border p-2 col-5 m-2">
                                <div class="card-body">
                                  <h5 class="card-title">@<%=review.author.username %>
                                  </h5>
                                  <p class="card-text">
  
                                  <p class="starability-result small-stars" data-rating="<%=review.rating %>">
                                  </p>
                                  </p>
                                  <p class="card-text">
                                    <%= review.comment %>
                                  </p>
                                  <%if(currUser && review.author._id.equals(currUser._id)){%>
                                    <form action="/listings/<%=list.id%>/reviews/<%=review.id%>?_method=DELETE"
                                      method="post">
                                      <button class="btn btn-dark btn-sm">delete</button>
                                    </form>
                                    <%}%>
  
                                </div>
  
                              </div>
                              <%}%>
                          </div>
                          <hr>
                       <%}%>
                        <!-- <%=list.reviews%> -->
                         <div>
                         <h1>Where you'll be</h1>
                        <div id='map' style='width: 800px; height: 400px; border-radius: 1rem ;'></div>
                        </div>
          </div>
        </div>
      </div>
    </div>

  </body>
  <script src="/js/map.js"></script>